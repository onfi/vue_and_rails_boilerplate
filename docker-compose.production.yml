version: '3'
services:
    front:
        build:
            context: front
            target: production
            args:
                UID: $UID
                GID: $GID
        tty: true
        ports:
            - 0.0.0.0:80:80
        environment:
            - NGINX_HOST=foobar.com
    api:
        build:
            context: api
            target: production
            args:
                UID: $UID
                GID: $GID
        tty: true
        ports:
            - 0.0.0.0:3000:3000
        command: rails server -b 0.0.0.0
    mysql:
        image: mysql:8.0.26
        environment:
            MYSQL_ROOT_PASSWORD: password
            MYSQL_DATABASE: api
            MYSQL_USER: api
            MYSQL_PASSWORD: api
            TZ: 'Asia/Tokyo'
        volumes:
            - mysql-data:/var/lib/mysql
            - ./mysql/my.cnf:/etc/mysql/conf.d/my.cnf
volumes:
    mysql-data: